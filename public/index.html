<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Angry Remote</title>

<style>
:root{
  --bg:#0e0f13;
  --panel:#161823;
  --btn:#2a2d3a;
  --primary:#6b4cff;
  --danger:#ff3b30;
  --text:#ffffff;
  --muted:#9aa0b6;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
}

.wrap{
  max-width:720px;
  margin:auto;
  padding:16px;
}

.top{
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

.badge{
  background:var(--panel);
  padding:10px 14px;
  border-radius:999px;
  display:flex;
  gap:10px;
  align-items:center;
}

.ok{ color:#41d07a; font-weight:700; }

.tabs{
  display:flex;
  gap:10px;
  margin:14px 0;
}

.tab{
  flex:1;
  background:var(--panel);
  border:1px solid #2d3146;
  color:white;
  padding:14px;
  border-radius:999px;
  font-weight:700;
}

.tab.active{
  outline:2px solid var(--primary);
}

.panel{
  background:var(--panel);
  border-radius:18px;
  padding:14px;
  border:1px solid #2d3146;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:14px;
}

button{
  border:0;
  border-radius:16px;
  padding:16px;
  font-size:16px;
  font-weight:800;
  background:var(--btn);
  color:white;
}

button.primary{ background:var(--primary); }
button.danger{ background:var(--danger); }

input, select{
  background:#0f111a;
  color:white;
  border:1px solid #2d3146;
  border-radius:12px;
  padding:10px;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="badge">
      CODE: <b id="codeLabel">----</b>
      <span class="ok">online</span>
    </div>

    <div class="badge">
      Etapa
      <select id="stage">
        <option value="start">StartScene</option>
        <option value="select">Level Select</option>
        <option value="level">Gameplay</option>
      </select>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" id="p1">Player 1</button>
    <button class="tab" id="p2">Player 2</button>
  </div>

  <div class="panel">
    <div style="display:flex; gap:10px;">
      <input id="codeInput" placeholder="CODE (ej: JLYF)">
      <button id="save">OK</button>
    </div>

    <div id="buttons" class="grid"></div>
  </div>

</div>

<script>
const state = {
  code:"",
  player:"P1",
  stage:"start"   // ðŸ‘ˆ SIEMPRE arranca en StartScene
};

const buttonsEl = document.getElementById("buttons");
const codeLabel = document.getElementById("codeLabel");
const stageSel  = document.getElementById("stage");

function send(cmd){
  if(!state.code){ alert("Falta CODE"); return; }

  fetch("/api/send",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      code:state.code,
      player:state.player,
      cmd: `${state.player}_${cmd}`
    })
  });
}

const BUTTONS = {
  start:[
    ["PLAY","PLAY","primary"],
    ["TRAILER","TRAILER"],
    ["EXIT TRAILER","EXITTRAILER"],
    ["EXIT","EXIT","danger"]
  ],
  select:[
    ["LEFT","LEFT"],
    ["RIGHT","RIGHT"],
    ["PLAY","PLAY","primary"],
    ["EXIT","EXIT","danger"]
  ],
  level:[
    ["OVEJITA","OVEJITA","primary"],
    ["OVEJITA PODER","OVEJITAENOJADAPODER"],
    ["PATITO","PATITO","primary"],
    ["PATITO PODER","PATITOENOJADOPODER"],
    ["RESTART","RESTART"],
    ["EXIT","EXIT","danger"]
  ]
};

function render(){
  buttonsEl.innerHTML="";
  BUTTONS[state.stage].forEach(([label,cmd,css])=>{
    const b=document.createElement("button");
    b.textContent=label;
    if(css) b.classList.add(css);
    b.onclick=()=>send(cmd);
    buttonsEl.appendChild(b);
  });
}

document.getElementById("save").onclick=()=>{
  state.code = document.getElementById("codeInput").value.toUpperCase().trim();
  codeLabel.textContent = state.code;
};

document.getElementById("p1").onclick=()=>{
  state.player="P1";
  document.getElementById("p1").classList.add("active");
  document.getElementById("p2").classList.remove("active");
};

document.getElementById("p2").onclick=()=>{
  state.player="P2";
  document.getElementById("p2").classList.add("active");
  document.getElementById("p1").classList.remove("active");
};

stageSel.onchange=()=>{
  state.stage=stageSel.value;
  render();
};

render(); // ðŸ‘ˆ render inicial SIN mandar comandos
</script>
</body>
</html>
